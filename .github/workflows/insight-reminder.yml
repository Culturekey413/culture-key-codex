name: Weekly Insights Reminder

on:
  schedule:
    - cron: "0 9 * * MON"   # ÎºÎ¬Î¸Îµ Î”ÎµÏ…Ï„Î­ÏÎ± 09:00 UTC
  workflow_dispatch:        # Î¼Ï€Î¿ÏÎµÎ¯Ï‚ Î½Î± Ï„Î¿ Ï„ÏÎ­Ï‡ÎµÎ¹Ï‚ ÎºÎ±Î¹ Ï‡ÎµÎ¹ÏÎ¿ÎºÎ¯Î½Î·Ï„Î±

permissions:
  issues: write
  contents: read

jobs:
  remind:
    runs-on: ubuntu-latest
    steps:
      - name: Ping or create reminder issue
        uses: actions/github-script@v7
        with:
          script: |
            const { owner, repo } = context.repo;
            const label = "insights";
            // Î’ÏÎµÏ‚ Î±Î½Î¿Î¹Ï‡Ï„ÏŒ issue Ï…Ï€ÎµÎ½Î¸ÏÎ¼Î¹ÏƒÎ·Ï‚
            const issues = await github.rest.issues.listForRepo({ owner, repo, state: "open", labels: label });
            let issue = issues.data.find(i => /Weekly Insights Reminder/i.test(i.title));
            if (!issue) {
              // Î±Î½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹, Ï†Ï„Î¹Î¬Î¾â€™ Ï„Î¿
              const body = [
                "ğŸ“Š **Weekly Insights Reminder**",
                "",
                "Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎµ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿: `metrics/INSIGHTS_LOG.md`",
                "",
                "- [ ] Î ÏÏŒÏƒÎ¸ÎµÏƒÎµ Ï„Î± Views & Clones (14d)",
                "- [ ] ÎœÎ¹ÎºÏÏŒ ÏƒÏ‡ÏŒÎ»Î¹Î¿/ÏƒÎ·Î¼ÎµÎ¯Ï‰ÏƒÎ· (Ï„Î¹ Î¬Î»Î»Î±Î¾Îµ Î±Ï…Ï„Î® Ï„Î· Î²Î´Î¿Î¼Î¬Î´Î±)",
                "",
                "Link: `metrics/INSIGHTS_LOG.md`",
              ].join("\n");
              issue = (await github.rest.issues.create({
                owner, repo,
                title: "Weekly Insights Reminder",
                body,
                labels: [label]
              })).data;
              core.info(`Created issue #${issue.number}`);
            } else {
              // Î±Î»Î»Î¹ÏÏ‚, Î¬Ï†Î·ÏƒÎµ ÎµÎ²Î´Î¿Î¼Î±Î´Î¹Î±Î¯Î¿ ÏƒÏ‡ÏŒÎ»Î¹Î¿-Î½Ï„Î¹Î½Î³Îº
              await github.rest.issues.createComment({
                owner, repo, issue_number: issue.number,
                body: "â° Weekly ping â€” ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎµ Ï„Î¿ `metrics/INSIGHTS_LOG.md` ÏŒÏ„Î±Î½ Î­Ï‡ÎµÎ¹Ï‚ Ï‡ÏÏŒÎ½Î¿."
              });
              core.info(`Commented on issue #${issue.number}`);
            }
